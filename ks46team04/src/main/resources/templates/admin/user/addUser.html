<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/default}">

<head>
<meta charset="UTF-8">
<title th:text="${title}"></title>
	
	<!-- Custom styles for this template -->
	<link href="/css/sb-admin-2.min.css" rel="stylesheet">

	<!-- Custom styles for this page -->
	<link href="/vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">

	<!-- Custom styles for this template -->
	<link href="/css/sb-admin-2.min.css" rel="stylesheet">

	<!-- Custom styles for this page -->
	<link href="/vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">

</head>
<th:block layout:fragment="customJs">
	<script th:src="@{/js/jquery-3.6.4.js}"></script>
<script>
	$(function(){
			//alert('제이쿼리')
			function validationCheck(ele){
				let data = $(ele).val();
				let isValid = true;
				if(typeof data == 'undefined' || data == null || data == ''){
					isValid = false;	
				}
				return isValid;
			}
			
			$('#userId').change(function(){
				$('#addUserForm input').not('#userId').prop('disabled', true);
				$('#addUserForm button').not('#checkBtn').prop('disabled', true);
				$('#addUserForm select').prop('disabled', true);
			});
			
			$('#checkBtn').click(function(){
				const userIdEle = $('#userId');
				let userId = userIdEle.val();
				console.log(userId);
				if(typeof userId == 'undefined' || userId == null || userId == ''){
					alert('회원아이디를 입력해주세요');
					userIdEle.focus();
					return false;
				}
				let request = $.ajax({
					  url: '/user/idCheck',
					  method: 'POST',
					  data: { 'userId' : userId },
					  dataType: 'json'
				});
					 
				request.done(function( check ) {
					console.log(typeof check)
					console.log(check)
					if(!check){
						alert('중복된 아이디 입니다.');
						userIdEle.val('');
						userIdEle.focus();
					}else{
						// 중복이 아닐 경우 속성의 disabled를 제거
						$('#addUserForm input').prop('disabled', false);
						$('#addUserForm button').prop('disabled', false);
						$('#addUserForm select').prop('disabled', false);
					}
				});
					 
				request.fail(function( jqXHR, textStatus ) {
					alert(`Request failed: ${textStatus}`);
				});
			});
			
			$('#submitBtn').click(function(){
				const addUserForm = $('#addUserForm');
				const inputGroup = $('#addUserForm input');
				let isSubmit = true;
				inputGroup.each(function(idx, item){
					isSubmit = validationCheck(item);
					if(!isSubmit) {
						let msg = $(item).parents('tr').find('label').text();
						alert(msg + '입력해주세요.');
						$(item).focus();
						return false;
					}
				});
				if(isSubmit) addUserForm.submit();
			});
		});
	
	</script>
	</th:block>
	<th:block layout:fragment="customContents">
	<!-- Begin Page Content -->
	<div class="container-fluid">

	
	<!-- /.container-fluid -->

			<!-- Page Heading -->
			<h1 class="h3 mb-2 text-gray-800">회원 등록</h1>
			<p class="mb-4">
				회원 등록입니다. <a target="_blank" href="http://localhost/admin/user/userList">전체 회원 목록 바로가기</a>
			</p>

			<div class="card shadow mb-4">
				<div class="card-header py-3">
					<h6 class="m-0 font-weight-bold text-primary">회원 등록</h6>
				</div>
			
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-bordered search-table-gr table-layout" id="searchTable" width="100%" cellspacing="0">
							<tbody>
								<tr>
									<th class="bg-gray-100">
										<label for="userId">아이디</label>
									</th>
									<td>
										<div class="form-row align-items-center search-schedule">
											<input type="text" class="form-control form-control-user-search search-input-gr" id="userId" name="userId" placeholder="영문+숫자 6~12자 이내"/>
											&nbsp;
												<button type="button" id="checkBtn" class="btn btn-primary btn-icon-split"> <span class="text">아이디 중복체크</span></button>
										</div>
									</td>
									
                                    
								</tr>
								<tr>
									<th class="bg-gray-100">
										<label for="userLevel">등급</label>
									</th>
									<td>
										<div class="form-row align-items-center search-schedule">
											<input type="text" class="form-control form-control-user-search search-input-gr" id="userLevel" name="userLevel" placeholder="관리자:1 회원:2"/>
										</div>
									</td>
									</tr>
								<tr>
									<th class="bg-gray-100">
										<label for="userPw">비밀번호</label>
									</th>
									<td>
										<div class="form-row align-items-center search-schedule">
											<input type="password" class="form-control form-control-user-search search-input-gr" id="userPw" name="userPw" placeholder="영문+숫자 8~20자 이내"/>
										</div>
									</td>
									</tr>
								<tr>
									<th class="bg-gray-100">
										<label for="userName">이름</label>
									</th>
									<td>
										<div class="form-row align-items-center search-schedule">
											<input type="text" class="form-control form-control-user-search search-input-gr" id="userName" name="userName" placeholder="이름을 입력해주세요."/>
				
										</div>
									</td>
								</tr>
								<tr>
									<th class="bg-gray-100">
										<label for="userBirth">생년월일</label>
									</th>
									<td>
										<div class="form-row align-items-center search-schedule">
											<input type="date" class="form-control form-control-user-search search-input-gr" id="userBirth" name="userBirth" />
				
										</div>
									</td>
								</tr>
								<tr>
									<th class="bg-gray-100">
										<label for="userPhone">연락처</label>
									</th>
									<td>
										<div class="form-row align-items-center search-schedule">
											<input type="tel" class="form-control form-control-user-search search-input-gr" id="userPhone" name="userPhone" placeholder="하이픈(-)을 포함하여 입력해주세요."/>
										</div>
						
									</td>
								</tr>
									<tr>
									<th class="bg-gray-100">
										<label for="userEmailAgree">이메일 수신여부</label>
									</th>
									<td>
										<div class="form-row align-items-center search-schedule">
											<input type="radio" id="userEmailAgree" value="1" checked name="userEmailAgree" /> 수신동의
											&nbsp;
											<input type="radio" id="userEmailAgree" value="0" name="userEmailAgree" /> 수신거부
	
										</div>
									</td>
								</tr>
								<tr>
									<th class="bg-gray-100">
										<label for="userEmail">이메일</label>
									</th>
									<td>
										<div class="form-row align-items-center search-schedule">
											<input type="email" class="form-control form-control-user-search search-input-gr" id="userEmail" name="userEmail" placeholder="at sign(@)을 포함하여 입력해주세요."/>
										</div>
						
									</td>
								</tr>
								<tr>
									<th class="bg-gray-100">
										<label for="userAddr">주소</label>
									</th>
									<td>
										<div class="form-row align-items-center search-schedule">
											<input type="text" class="form-control form-control-user-search search-input-gr" id="userAddr" name="userAddr" placeholder="주소를 입력해주세요."/>
											<input type="text" class="form-control form-control-user-search search-input-gr" id="userAddr" name="userAddr" placeholder="상세주소를 입력해주세요."/>
											<button type="button" id="checkBtn" class="btn btn-primary btn-icon-split">
											&nbsp;
												<span class="text">주소 검색</span>
											</button>
										</div>
									</td>
								</tr>
								
							</tbody>
						</table>
						<div align="center">
							<button type="button" id="submitBtn" class="btn btn-primary btn-icon-split">
								<span class="icon text-white-50"><i class="fas fa-check"></i></span>
								<span class="text">회원등록</span>
							</button>
							<button type="reset" id="resetBtn" class="btn btn-secondary btn-icon-split">
								<span class="icon text-white-50"><i class="fas fa-trash"></i></span>
								<span class="text">입력취소</span>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	
	<!-- /.container-fluid -->

	<!-- Scroll to Top Button-->
	<a class="scroll-to-top rounded" href="#page-top"> <i class="fas fa-angle-up"></i>
	</a>
	
</th:block>

<th:block layout:fragment="customJs">
	<!-- Page level plugins -->
	<script th:src="@{/vendor/datatables/jquery.dataTables.min.js}"></script>
	<script th:src="@{/vendor/datatables/dataTables.bootstrap4.min.js}"></script>
	<!-- Page level custom scripts -->
	<script th:src="@{/js/demo/datatables-demo.js}"></script>
</th:block>

</html>