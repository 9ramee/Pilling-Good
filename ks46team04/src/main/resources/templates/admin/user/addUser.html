<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/default}">


<th:block layout:fragment="customContents">
<script th:src="@{/js/jquery-3.6.4.js}"></script>
                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
                    <h1 class="h3 mb-4 text-gray-800">회원 정보 등록 관리</h1>
<script>
	$(function(){
			//alert('제이쿼리')
			function validationCheck(ele){
				let data = $(ele).val();
				let isValid = true;
				if(typeof data == 'undefined' || data == null || data == ''){
					isValid = false;	
				}
				return isValid;
			}
			
			$('#userId').change(function(){
				$('#addUserForm input').not('#userId').prop('disabled', true);
				$('#addUserForm button').not('#checkBtn').prop('disabled', true);
				$('#addUserForm select').prop('disabled', true);
			});
			
			$('#checkBtn').click(function(){
				const userIdEle = $('#userId');
				let userId = userIdEle.val();
				console.log(userId);
				if(typeof userId == 'undefined' || userId == null || userId == ''){
					alert('회원아이디를 입력해주세요');
					userIdEle.focus();
					return false;
				}
				let request = $.ajax({
					  url: '/user/idCheck',
					  method: 'POST',
					  data: { 'userId' : userId },
					  dataType: 'json'
				});
					 
				request.done(function( check ) {
					console.log(typeof check)
					console.log(check)
					if(!check){
						alert('중복된 아이디 입니다.');
						userIdEle.val('');
						userIdEle.focus();
					}else{
						// 중복이 아닐 경우 속성의 disabled를 제거
						$('#addUserForm input').prop('disabled', false);
						$('#addUserForm button').prop('disabled', false);
						$('#addUserForm select').prop('disabled', false);
					}
				});
					 
				request.fail(function( jqXHR, textStatus ) {
					alert(`Request failed: ${textStatus}`);
				});
			});
			
			$('#submitBtn').click(function(){
				const addUserForm = $('#addUserForm');
				const inputGroup = $('#addUserForm input');
				let isSubmit = true;
				inputGroup.each(function(idx, item){
					isSubmit = validationCheck(item);
					if(!isSubmit) {
						let msg = $(item).parents('tr').find('label').text();
						alert(msg + '입력해주세요.');
						$(item).focus();
						return false;
					}
				});
				if(isSubmit) addUserForm.submit();
			});
		});
	
	</script>
</th:block>

<th:block layout:fragment="customContents">
	<form id="addUserForm" th:action="@{/user/add_user}" method="post">
		<table>
			<tbody>
				<tr>
					<td class="labeltd">
						<label for="userId">회원아이디</label>
					</td>
					<td>
						<input type="text" id="userId" 
							   name="userId" placeholder="회원아이디를 입력해주세요." />
					</td>
					<td>
						<button type="button" id="checkBtn">아이디 중복체크</button>
					</td>
				</tr>
				<tr>
					<td class="labeltd">
						<label for="userPw">회원비밀번호</label>
					</td>
					<td colspan="2">
						<input type="text" id="userPw" 
							   name="userPw" placeholder="회원비밀번호를 입력해주세요." />
					</td>
				</tr>								
				<tr>
					<td class="labeltd">
						<label for="userName">회원이름</label>
					</td>
					<td colspan="2">
						<input type="text" id="userName" 
							   name="userName" placeholder="이름을 입력해주세요."  />
					</td>
				</tr>	
					<tr>
					<td class="labeltd">
						<label for="userBirth">회원생년월일</label>
					</td>
					<td colspan="2">
						<input type="date" id="userBirth" 
							   name="userBirth" placeholder="생년월일을 선택해주세요."  />
					</td>
				</tr>								
					<tr>
					<td class="labeltd">
						<label for="userPhone">회원연락처</label>
					</td>
					<td colspan="2">
						<input type="text" id="userPhone" 
							   name="userPhone" placeholder="연락처를 입력해주세요." />
					</td>
				</tr>															
					<tr>
					<td class="labeltd">
						<label for="userEmailAgree">회원이메일 수신여부</label>
					</td>
					<td colspan="2">
						<input type="radio" id="userEmailAgree" value="1" checked
							   name="userEmailAgree"  />수신동의
							   <input type="radio" id="userEmailAgree" value="0" 
							   name="userEmailAgree" />수신거부
					</td>
				</tr>								
						
				<tr>
					<td class="labeltd">
						<label for="userEmail">회원이메일</label>
					</td>
					<td colspan="2">
						<input type="email" id="userEmail" 
							   name="userEmail" placeholder="이메일을 입력해주세요." />
					</td>
				</tr>						
				<tr>
					<td class="labeltd">
						<label for="userAddr">회원주소</label>
					</td>
					<td colspan="2">
						<input type="text" id="userAddr" 
							   name="userAddr" placeholder="주소를 입력해주세요."  />
					</td>
				</tr>		
			
				<tr>
					<td colspan="3">
						<button type="button" id="submitBtn" >회원가입</button>
						<button type="reset" id="resetBtn">입력취소</button>
					</td>
				</tr>								
			</tbody>
		</table>
	</form>
			
                </div>
                <!-- /.container-fluid -->

</th:block>

</html>